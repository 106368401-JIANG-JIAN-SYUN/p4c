#!/bin/sh

# This script creates the file backendMakefiles.am for the P4C compiler toolchain
# The file is created by inserting "include" statements for other Makefile.am files.
# The included Makefile.am files are sought in two places:
# - all Makefile.am files found in the subdirectories of the "backends" directory.
#   These files are part of the "standard" back-ends distributed with the compiler.
# - all Makefile.am files found in subdirectories of the "extensions" directory.
#   These makefiles are part of customized extensions fo the compiler.
#   (The files in the "extensions" directory are not part of the compiler source tree;
#   they are expected to be symlinks to custom back-ends.)

resultMakefile="otherMakefiles.am"
dirsToSearch="backends extensions"

echo "Creating $resultMakefile"

echo "### This file is automatically generated from $mainMakefile" >$resultMakefile
echo "### by the program create-makefile.am.sh" >>$resultMakefile

for d in $dirsToSearch; do
   for f in $d/*; do 
       if [ -f $f/Makefile.am ]; then
           echo "Adding $f/Makefile.am"
           echo "include \$(srcdir)/$f/Makefile.am\n" >>$resultMakefile
        fi
    done
done



